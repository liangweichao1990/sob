<!-- 
    页面：历史隐患查询详情页面
    作者：梁伟超
    日期：2014-02-18
    版本：1.0
-->
<!DOCTYPE html>

<html>
    
    <head>
        <title></title>
        <meta charset="utf-8" />
    </head>
    
    <body> 
        
        <!-- 历史隐患查询详情页面 -->
        <div id="historyRiskSearchDetailView" data-theme="a" data-role="page" data-transition="slide">
            
            <header data-role="header" id="historyRiskSearchDetailViewHeader"  data-theme="a" data-position="fixed" data-tap-toggle="false">
                <a data-role="button" data-icon="arrow-l" data-rel="back">返回</a>
                <h1>四个百分率</h1> 
                <div data-role="navbar">  
                    <ul>  
                        <li>
                            <select data-corners="false" id="historyRiskSearchDetail_area" onchange="changeHistoryRiskSearchDetailArea()">
                                <option value="全市">全市</option>
                                <option value="各区">各区</option>
                                <option value="重点部门">重点部门</option>
                            </select>
                        </li>  
                        <li>
                            <select data-corners="false" id="historyRiskSearchDetail_year" onchange="changeHistoryRiskSearchDetailYear()">
                            </select>
                        </li>  
                        <li>
                            <select data-corners="false" id="historyRiskSearchDetail_season" onchange="changeHistoryRiskSearchDetailSeason()">
                                <option value="一季度">一季度</option>
                                <option value="二季度">二季度</option>
                                <option value="三季度">三季度</option>
                                <option value="四季度">四季度</option>
                                <option value="上半年">上半年</option>
                                <option value="下半年">下半年</option>
                                <option value="全年">全年</option>
                            </select>
                        </li>  
                    </ul>
                </div>
                
                <div id="historyRiskSearchDepartmentBtnListDiv">
                    <div data-role="navbar" id="historyRiskSearchDepartmentBtnList">  
                        <ul>  
                            <li><a id="changeHistoryRiskSearchDepartment_xf" onclick="changeHistoryRiskSearchDepartment('消防')">消防</a> </li>
                            <li><a id="changeHistoryRiskSearchDepartment_aj" onclick="changeHistoryRiskSearchDepartment('安监')">安监</a> </li>
                            <li><a id="changeHistoryRiskSearchDepartment_jt" onclick="changeHistoryRiskSearchDepartment('交通')">交通</a> </li>
                            <li><a id="changeHistoryRiskSearchDepartment_jy" onclick="changeHistoryRiskSearchDepartment('教育')">教育</a> </li>
                            <li><a id="changeHistoryRiskSearchDepartment_zj" onclick="changeHistoryRiskSearchDepartment('住建')">住建</a> </li>
                        </ul>
                    </div>
                </div>
                
                <div id="historyRiskSearchDistrictBtnListDiv">
                    <div data-role="navbar" id="historyRiskSearchDistrictBtnList">  
                        <ul>  
                            <li><a id="changeHistoryRiskSearchDistrict_xz" onclick="changeHistoryRiskSearchDistrict('香洲')">香洲</a> </li>
                            <li><a id="changeHistoryRiskSearchDistrict_dm" onclick="changeHistoryRiskSearchDistrict('斗门')">斗门</a> </li>
                            <li><a id="changeHistoryRiskSearchDistrict_jw" onclick="changeHistoryRiskSearchDistrict('金湾')">金湾</a> </li>
                            <li><a id="changeHistoryRiskSearchDistrict_hq" onclick="changeHistoryRiskSearchDistrict('横琴')">横琴</a> </li>
                            <li><a id="changeHistoryRiskSearchDistrict_bs" onclick="changeHistoryRiskSearchDistrict('保税')">保税</a> </li>
                        </ul>
                    </div>
                </div>
                
            </header>
            
            <div data-role="none">
                    
                <div id="historyRiskSearchDetail_title" style="text-align:center">
                    <div style="color:red" id="historyRiskSearchDetail_st_title">全市2014年第1季度</div>
                </div>
                
                <!-- 竖屏数据 -->
                <div id="historyRiskSearchPortData">
                    <div id="historyRiskSearchDetailBarChart" style="text-align:center;margin:0 auto;" onclick="viewChartDetail()"></div>
                </div>
                
                <!-- 横屏数据 -->
                <div id="historyRiskSearchLandData">
                    <div style="width:100%;">
                        <div class="fourPercentagesTd_gray overflow_ellipsis" style="width:30%;">类型</div>
                        <div class="fourPercentagesTd_gray overflow_ellipsis" style="width:30%;">企业总数</div>
                        <div class="fourPercentagesTd_gray overflow_ellipsis" style="width:40%;">上报数(查处、检查、抽查)</div>
                    </div>
                    
                    <div style="width:100%;">
                        <div class="fourPercentagesTd_white overflow_ellipsis" style="width:30%;">企业上报率(61%)</div>
                        <div class="fourPercentagesTd_white" style="width:30%">9726</div>
                        <div class="fourPercentagesTd_white" style="width:40%">5933</div>
                    </div>
                    
                    <div style="width:100%;">
                        <div class="fourPercentagesTd_lightgray overflow_ellipsis" style="width:30%;">黑名单企业查处率(1.9%)</div>
                        <div class="fourPercentagesTd_lightgray" style="width:30%">2588</div>
                        <div class="fourPercentagesTd_lightgray" style="width:40%">49</div>
                    </div>
                    
                    <div style="width:100%;">
                        <div class="fourPercentagesTd_white overflow_ellipsis" style="width:30%;">零隐患企业检查率(8.1%)</div>
                        <div class="fourPercentagesTd_white" style="width:30%">2725</div>
                        <div class="fourPercentagesTd_white" style="width:40%">221</div>
                    </div>
                    
                    <div style="width:100%;">
                        <div class="fourPercentagesTd_lightgray overflow_ellipsis" style="width:30%;">其他企业抽查率(21.9%)</div>
                        <div class="fourPercentagesTd_lightgray" style="width:30%">4184</div>
                        <div class="fourPercentagesTd_lightgray" style="width:40%">915</div>
                    </div>
                </div>
                
            </div>
            
            <script>
                
                if(fourPercentages_area == "全市")
                {
                    $("#historyRiskSearchDistrictBtnListDiv").hide();
                    $("#historyRiskSearchDepartmentBtnListDiv").hide();
                }
                if(fourPercentages_area == "各区")
                {
                    $("#historyRiskSearchDistrictBtnListDiv").show();
                    $("#historyRiskSearchDepartmentBtnListDiv").hide();
                    $("#changeHistoryRiskSearchDistrict_xz").addClass("ui-btn-active");
                }
                else if(fourPercentages_area == "重点部门")
                {
                    $("#historyRiskSearchDistrictBtnListDiv").hide();
                    $("#historyRiskSearchDepartmentBtnListDiv").show();
                    $("#changeHistoryRiskSearchDepartment_xf").addClass("ui-btn-active");
                }
                
                // 改变部门选择
                function changeHistoryRiskSearchDepartment(department)
                {
                    var tc = "";
                    if(department == "住建")
                    {
                        tc = '<div data-role="navbar" id="historyRiskSearchDepartmentBtnList"><ul><li><a id="changeHistoryRiskSearchDepartment_jy" data-role="button" onclick="changeHistoryRiskSearchDepartment(\'教育\')">教育</a></li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_zj" onclick="changeHistoryRiskSearchDepartment(\'住建\')">住建</a></li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_ws" onclick="changeHistoryRiskSearchDepartment(\'卫生\')">卫生</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_gk" onclick="changeHistoryRiskSearchDepartment(\'港口\')">港口</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_yl" onclick="changeHistoryRiskSearchDepartment(\'园林\')">园林</a> </li></ul></div>';
                        
                    }
                    else if(department == "教育")
                    {
                        tc = '<div data-role="navbar" id="historyRiskSearchDepartmentBtnList"><ul><li><a id="" data-role="button" onclick="changeHistoryRiskSearchDepartment(\'消防\')">消防</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_aj" onclick="changeHistoryRiskSearchDepartment(\'安监\')">安监</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_jt" onclick="changeHistoryRiskSearchDepartment(\'交通\')">交通</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_jy" onclick="changeHistoryRiskSearchDepartment(\'教育\')">教育</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDepartment_zj" onclick="changeHistoryRiskSearchDepartment(\'住建\')">住建</a> </li></ul></div>';
                        
                    } 
                        
                    if(tc != "")
                    {
                        $("#historyRiskSearchDepartmentBtnListDiv").empty();
                        $("#historyRiskSearchDepartmentBtnListDiv").append(tc);
                        $("#historyRiskSearchDepartmentBtnListDiv div").navbar();
                        if(department == "住建")
                        {
                            $("#changeHistoryRiskSearchDepartment_zj").addClass("ui-btn-active");
                        }
                        else if(department == "教育")
                        {
                            $("#changeHistoryRiskSearchDepartment_jy").addClass("ui-btn-active");
                        }
                    }
                    
                }
                        
                // 改变区选择
                function changeHistoryRiskSearchDistrict(district)
                {
                    var tc = "";
                    if(district == "保税")
                    {
                        tc = '<div data-role="navbar" id="historyRiskSearchDistrictBtnList"><ul><li><a id="changeHistoryRiskSearchDistrict_hq" data-role="button" onclick="changeHistoryRiskSearchDistrict(\'横琴\')">横琴</a></li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_bs" onclick="changeHistoryRiskSearchDistrict(\'保税\')">保税</a></li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_ws" onclick="changeHistoryRiskSearchDistrict(\'万山\')">万山</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_gx" onclick="changeHistoryRiskSearchDistrict(\'高新\')">高新</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_gl" onclick="changeHistoryRiskSearchDistrict(\'高栏\')">高栏</a> </li></ul></div>';
                        
                    }
                    else if(district == "横琴")
                    {
                        tc = '<div data-role="navbar" id="historyRiskSearchDistrictBtnList"><ul><li><a id="changeHistoryRiskSearchDistrict_xz" data-role="button" onclick="changeHistoryRiskSearchDistrict(\'香洲\')">香洲</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_dm" onclick="changeHistoryRiskSearchDistrict(\'斗门\')">斗门</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_jw" onclick="changeHistoryRiskSearchDistrict(\'金湾\')">金湾</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_hq" onclick="changeHistoryRiskSearchDistrict(\'横琴\')">横琴</a> </li>' +
                        '<li><a id="changeHistoryRiskSearchDistrict_bs" onclick="changeHistoryRiskSearchDistrict(\'保税\')">保税</a> </li></ul></div>';
                        
                    } 
                        
                    if(tc != "")
                    {
                        $("#historyRiskSearchDistrictBtnListDiv").empty();
                        $("#historyRiskSearchDistrictBtnListDiv").append(tc);
                        $("#historyRiskSearchDistrictBtnListDiv div").navbar();
                        if(district == "保税")
                        {
                            $("#changeHistoryRiskSearchDistrict_bs").addClass("ui-btn-active");
                        }
                        else if(district == "横琴")
                        {
                            $("#changeHistoryRiskSearchDistrict_hq").addClass("ui-btn-active");
                        }
                    }
                    
                }
                
                // 把年份值添加到年份下拉框中
                for(var i = 1970; i <= currentYear; i++)
                {
                    if(i == currentYear)    // 如果是当前年份，则把它选中
                    {
                        $("<option selected='selected' value='" + i + "'>" + i + "</option>").prependTo($("#historyRiskSearchDetail_year"));
                    }
                    else
                    {
                        $("<option value='" + i + "'>" + i + "</option>").prependTo($("#historyRiskSearchDetail_year"));
                    }
                }
                
                $("#historyRiskSearchDetail_area").val(fourPercentages_area);    // 设置上一页传过来的区域查询值
                $("#historyRiskSearchDetail_year").val(fourPercentages_year);    // 设置上一页传过来的年份查询值
                $("#historyRiskSearchDetail_season").val(fourPercentages_season);// 设置上一页传过来的季度查询值
                
                // 改变区域选择
                function changeHistoryRiskSearchDetailArea()
                {
                    fourPercentages_area = $("#historyRiskSearchDetail_area").val();
                }
                
                // 改变年份选择
                function changeHistoryRiskSearchDetailYear()
                {
                    fourPercentages_year = $("#historyRiskSearchDetail_year").val();
                }
                
                // 改变季度选择
                function changeHistoryRiskSearchDetailSeason()
                {
                    fourPercentages_season = $("#historyRiskSearchDetail_season").val();
                }
                
                $("#historyRiskSearchDetail_st_title").html(fourPercentages_area + fourPercentages_year + "年" + fourPercentages_season);
                
                // 图表数据
                var data = [
				        	{name : '企业总数',value : [9726, 2588, 2725, 4184],color:'#1385a5'},
				        	{name : '上报数',value : [5933, 49, 221, 915],color:'#c56966'}
				      ];
		        	
					new iChart.ColumnMulti2D({
                        align:'center',
						render : 'historyRiskSearchDetailBarChart',
						data: data,
                        labels:["上报率","黑名单查处","零隐患检查","其他抽查"],
						title : '四个百分率统计图表', 
						showpercent:false,
						decimalsnum:0,
						width : deviceWidth,
						height : deviceHeight / 1.3,
                        border:0,
                        background_color: null,
                        legend:{
							enable:true,
                            align:'center',
                            valign:'top',
							background_color : '#fff',
							border : {
								enable : true
							}
						},
						coordinate:{
							background_color:'#fefefe',
							scale:[{
                                 scale_enable: false,
                                 scale_share: 0,
								 position:'left',
								 start_scale:0,
								 end_scale:0,
								 scale_space:0,
								 listeners:{
									parseText:function(t,x,y){
										return {text:t}
									}
								}
							}]
						}
					}).draw();
                
                // 判断当前的屏幕状态
                if(window.orientation == 0 || window.orientation == 180)    // 当前是竖屏
                {
                    $("#historyRiskSearchPortData").css("display","block");
                    $("#historyRiskSearchLandData").css("display","none");
                }
                else if(window.orientation == 90 || window.orientation == -90)    // 当前是横屏
                {
                     $("#historyRiskSearchPortData").css("display","none");
                     $("#historyRiskSearchLandData").css("display","block");
                }
                
                // 用户进行屏幕转动时的事件处理
                $(window).bind("orientationchange", function( event ) { 
                    if(event.orientation)
                    { 
                        if(event.orientation == 'portrait')    // 竖屏
                        { 
                            $("#historyRiskSearchPortData").css("display","block");
                            $("#historyRiskSearchLandData").css("display","none");
                        } 
                        else if(event.orientation == 'landscape') // 横屏
                        { 
                            $("#historyRiskSearchPortData").css("display","none");
                            $("#historyRiskSearchLandData").css("display","block");
                        } 
                    } 
                });
                
                // 打开新页面查看图表
                function viewChartDetail()
                {
                     $.mobile.changePage("./historyRiskSearchChartDetail.html",{transition:"slide"});
                }
            </script>
        </div>
        
    </body>
    
</html>