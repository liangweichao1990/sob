<!-- 
    页面：四个百分率主页面
    作者：梁伟超
    日期：2014-02-17
    版本：1.0
-->
<!DOCTYPE html>

<html>
    
    <head>
        <title></title>
        <meta charset="utf-8" />
    </head>
    
    <body>
        
        <!-- 主页 -->
        <div id="fourPercentagesView"  data-theme="a" data-transition="none" data-role="page" data-add-back-btn="true" data-back-btn-text="返回">
            
            <div data-role="header"  data-theme="a">
                <a data-role="button" data-icon="arrow-l" data-rel="back">返回</a>
                <h1>四个百分率查询</h1> 
            </div>
            
            <div data-role="content">
                
                <!-- 季度查询 -->
                <div style="margin-top:5%">
                    <div style="width:100%;text-align:center">2014年第一季度</div>
                    <div style="width:100%;margin:0 auto;margin-top:1%;text-align:center;padding-top:.5em;padding-bottom:.5em">
                        <div data-role="navbar">  
                            <ul>  
                                <li><a href="javascript:seasonSearch('全市')">全市</a></li>
                                <li><a href="javascript:seasonSearch('各区')">各区</a></li>
                                <li><a href="javascript:seasonSearch('重点部门')">重点部门</a></li>
                            </ul>  
                        </div>
                    </div>
                </div>
                
                <!-- 历史查询 -->
                <div style="margin-top:5%">
                    <div style="width:100%;text-align:center">历史查询</div>
                    <div style="width:100%;margin:0 auto;margin-top:1%;text-align:center;padding-bottom:.5em">
                        <div><a data-role="button" data-icon="arrow-r" data-iconpos="right" href="javascript:openHistoryRiskSearchPage()" style="text-align:center">历史企业隐患查询</a></div>
                    </div>
                </div>
                
                <!-- 备注信息 -->
                <div style="margin-top:10%;margin-left:2%;color:gray;font-size:.9em">
                    <div>备注：四个百分率是指--</div>
                    <div>
                        <ol style="line-height:1.7em">
                            <li>监管企业本季度的上报率。</li>
                            <li>对上季度"黑名单"企业查处(检查)率。</li>
                            <li>对上季度"零隐患"企业的检查率。</li>
                            <li>对上季度其它企业(指除"黑名单"和"零隐患"企业)的抽查率。</li>
                        </ol>
                    </div>
                </div>
                
                <div id="ImageContainer">
                    
                </div>
                
                <div id="GalleryView">
                    
                </div>
                
            </div>
            <script>
                


               var numDirs = 0;
               var numFiles = 0;
               var ImageFilePath = new Array();
               function fail1()
                {
                    alert("hehe");
                }
                
                function fail2()
                {
                    alert("haha");
                }
                
                function fail3()
                {
                    alert("fuck");
                }

                function GetAllImageFromSD() 
                {
                    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFileSystemSuccess, fail1);
                }

                function onFileSystemSuccess(fileSystem) 
                {
                    fileSystem.root.getDirectory("/sdcard", { create: false, exclusive: false }, getDirSuccess, fail2);
                }

                function getDirSuccess(dirEntry) 
                {
                    var directoryReader = dirEntry.createReader();
                    // Get a list of all the entries in the directory
                    directoryReader.readEntries(readerSuccess, fail3);
                }


                var readerTimeout = null, millisecondsBetweenReadSuccess = 10;

                function readerSuccess(entries) 
                {
                    String.prototype.startsWith = function (str)
                    { return (this.match("^" + str) == str) }

                    var i = 0, len = entries.length;
                    for (; i < len; i++) {
                        if (entries[i].isFile) {
                            if ((entries[i].name.indexOf(".jpeg") != -1) || (entries[i].name.indexOf(".png") != -1) || (entries[i].name.indexOf(".jpg") != -1)) {
                                var fileName = entries[i].name;
                                if (!fileName.startsWith(".")) {
                                    numFiles++;
                                    ImageFilePath.push(entries[i].fullPath)
                                    //  console.log("file "+entries[i].fullPath)
                                }
                            }

                        } else if (entries[i].isDirectory) {
                            numDirs++;
                            // console.log("directory "+entries[i].name)
                            var dirName = entries[i].name;
                            if (!dirName.startsWith(".")) {
                                getDirSuccess(entries[i]);
                            }
                        }
                        if (readerTimeout) {
                            window.clearTimeout(readerTimeout);
                        }
                    }
                    if (readerTimeout) {
                        window.clearTimeout(readerTimeout);
                    }
                    readerTimeout = window.setTimeout(weAreDone, millisecondsBetweenReadSuccess);
                }

                function weAreDone() 
                {

                    console.log("numDirs " + numDirs);
                    console.log("numFiles " + numFiles);

                    var a = "";

                    var GalleryImageTag = "";
                    GalleryImageTag = "<div class='spacingbox'></div> ";

                    for (var j = 0; j < ImageFilePath.length; j++) 
                    {
                        GalleryImageTag += "<div class='divgallery divcolor' style='width:5em;height:5em;display:inline'>"
                        var ChkId = "chk" + j;
                        GalleryImageTag += "<img class='imggallery' style='width:5em;overflow:hidden;' id='" + j + "' src=' " + ImageFilePath[j] + "'alt=''/>";
                        GalleryImageTag += "<input id='" + ChkId + "' name='" + ChkId + "' type='checkbox' value='" + ImageFilePath[j] + "' class='allignchk'>";
                        GalleryImageTag += "</div>";

                    }
                    $('#ImageContainer').html('');
                    $('#ImageContainer').append(GalleryImageTag);
                    $('#GalleryView').popup("open");
                    numDirs = 0;
                    numFiles = 0;

                    ImageFilePath = [];
                    console.log(GalleryImageTag);
                }

                GetAllImageFromSD();
            </script>
            
        </div>
        
    </body>
    
</html>